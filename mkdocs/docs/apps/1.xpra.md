# Xpra

xpra is an alternative to RDP
It has super fast almost native performance compared to rdp when I tested it against xfce
Also you can connect from the client just using a web browser (or the proper client software)

  * https://xpra.org/index.html - also contains windows version
  * https://github.com/Xpra-org/xpra
  * https://github.com/Xpra-org/xpra-html5

  * https://www.youtube.com/watch?v=2iBMsyfbC28
  * https://github.com/Xpra-org/xpra/blob/master/docs/Usage/Shadow.md
  * https://wiki.archlinux.org/title/Xpra
  * https://blog.ouseful.info/2019/03/11/running-microsoft-vs-code-remotely-xpra-and-rdp/
  * https://github.com/Xpra-org/xpra/blob/master/docs/Usage/Desktop.md

Currently I've got the latest version of xpra setup via an overlay

## Installing

```bash
# Todo add as a depend
emerge --oneshot dev-python/paramiko
emerge --oneshot dev-python/aioquic

# Setup some use flags
echo "x11-wm/xpra lzo webp vpx qrcode brotli gstreamer" >/etc/portage/package.use/xpra
echo "www-apps/xpra-html5 brotli" >>/etc/portage/package.use/xpra

# Install xpra
emerge =x11-wm/xpra-6.2.3
# This allows remote connections via a web browser to the session
emerge =www-apps/xpra-html5-17
```

## User Setup

The user running xpra needs to be in the xpra and video user groups
```bash
gpasswd -a ric video
gpasswd -a ric xpra
```

## Service setup

The service is needed for `xpra list` and `xpra stop` to work
```bash
systemctl start xpra
systemctl enable xpra
```

## Examples

### Working

konsole seems to work
```bash
xpra start :100 --start="konsole" --bind-tcp=0.0.0.0:10000
```







## Running

```bash
# Seems to partially work creates a new session
xpra start :100 --start="xfce4-session" --bind-tcp=0.0.0.0:10000

xpra start :100 --start="konsole" --bind-tcp=0.0.0.0:10000
# nearly works
# desktop doesnt resize?
xpra start-desktop :100 --resize-display="1920x1080" --start="startplasma-wayland" --bind-tcp=0.0.0.0:10000

# List active sessions
xpra list

# TODO
# this might work
xpra shadow wayland-0 --bind-tcp=0.0.0.0:10000
```

Running this while plasma is started up nearly works.
```bash
xpra shadow wayland-0 --bind-tcp=0.0.0.0:10000
```

But once you connect via the client to port 10000 via a web browser a prompt shows up on the kde desktop
asking if you want to confirm that remote access is allowed
So I think I need another form of command similar to this but to allow xpra instead
not quite sure what to replace `org.kde.krdpserver` with though
```bash
flatpak permission-set kde-authorized remote-desktop org.kde.krdpserver yes
```

  * https://develop.kde.org/docs/administration/portal-permissions/
  * http://192.168.111.74:10000/index.html
  * http://192.168.111.56:10000/index.html

## TODO

### Xorg

Currently there's only an option for installing / using under xorg
needs wayland

### xpra html5

xpra-html5 is placing its files under `/usr/share/xpra/www/`
but is not being picked up

looking at the logs
`websocket module is not installed`


### Use Flags

Current use flags
X client clipboard crypt cups dbus gtk3 jpeg lz4 opengl pulseaudio server sound systemd trayicon udev x264 
  
# Dont enable
-test
-debug
-xinerama - multiple monitors for xorg
-pinentry - secure prompting of passwords gpg
-minimal - minimal build
-html - html documenatation
-openh264 - use x264 instead
-examples - examples
-cuda - nvidia cards only
-oauth - used for authenticvation
-avif - AVI image format support
-csc - csc softscaler?
-doc - additional documentation
-ibus
-webcam webcam support

# per package
-brotli - web compression
-lzo - compression library
-webp - webp image format
-vpx - video codec
-qrcode - qrcode support
-gstreamer - multimedia framework